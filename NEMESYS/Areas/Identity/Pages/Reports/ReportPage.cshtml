@page
@using Microsoft.AspNetCore.Identity
@using NEMESYS.Areas.Identity.Data
@model NEMESYS.Areas.Identity.Pages.Reports.ReportPageModel

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Report an Incident";
    var isAuthenticated = User.Identity != null && User.Identity.IsAuthenticated;
}

@if (!isAuthenticated)
{
    <div class="alert alert-warning">
        To report an incident, please <a asp-area="Identity" asp-page="/Account/Login">log in</a>.
    </div>
}
else
{
    <h2>Report Details</h2>

    <dl>
        <dt>Date of Report</dt>
        <dd>@Model.CurrentReport.DateOfReport.ToString("yyyy-MM-dd")</dd>

        <dt>Location</dt>
        <dd>@Model.CurrentReport.Location</dd>

        <dt>Date Spotted</dt>
        <dd>@Model.CurrentReport.DateSpotted.ToString("yyyy-MM-dd")</dd>

        <dt>Time Spotted</dt>
        <dd>@Model.CurrentReport.TimeSpotted</dd>

        <dt>Type of Hazard</dt>
        <dd>@Model.CurrentReport.TypeOfHazard</dd>

        <dt>Description</dt>
        <dd>@Model.CurrentReport.Description</dd>

        <dt>Status</dt>
        <dd>@Model.CurrentReport.Status</dd>

        <dt>Reporter Email</dt>
        <dd>@Model.CurrentReport.ReporterEmail</dd>

        <dt>Reporter Phone (optional)</dt>
        <dd>@Model.CurrentReport.ReporterPhone</dd>
    </dl>

    @if (!string.IsNullOrEmpty(Model.CurrentReport.OptionalPhotoPath))
    {
        <img src="@Model.CurrentReport.OptionalPhotoPath" alt="Report Photo" />
    }

    @using (Html.BeginForm("UpdateStatus", "Report", FormMethod.Post))
    {
        <input type="hidden" name="newStatus" value="Closed" />
        <input type="submit" value="Close Report" />
    }
}
